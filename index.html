<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flappy Hardcore - Nível 8</title>
    <style>
        /* Estilos CSS para garantir que o jogo ocupe a tela e pareça bom */
        body {
            margin: 0;
            padding: 0;
            background-color: #222;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden; /* Impede barras de rolagem */
            touch-action: none; /* Impede zoom e gestos do navegador no mobile */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            user-select: none;
            -webkit-user-select: none;
        }

        #gameContainer {
            position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            width: 100%;
            height: 100%;
            max-width: 480px; /* Limita a largura em desktop para manter a dificuldade */
            background: #000;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #1a0b2e, #4a192c); /* Céu roxo/avermelhado ameaçador */
        }

        /* Camada de Interface (UI) sobre o Canvas */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Deixa os cliques passarem para o jogo quando necessário */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .score-board {
            position: absolute;
            top: 15%;
            font-size: 80px;
            font-weight: 900;
            color: rgba(255, 255, 255, 0.2); /* Score gigante no fundo */
            z-index: 1;
        }

        .current-score {
            position: absolute;
            top: 20px;
            font-size: 40px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 0 #000;
            z-index: 10;
        }

        /* Telas de Menu e Game Over */
        .message {
            background: rgba(20, 20, 20, 0.95);
            color: white;
            padding: 30px;
            border-radius: 12px;
            border: 3px solid #ff3333; /* Borda vermelha de perigo */
            box-shadow: 0 0 20px rgba(255, 51, 51, 0.3);
            display: none; /* Escondido por padrão */
            pointer-events: auto; /* Permite clicar nos botões */
            flex-direction: column;
            align-items: center;
            gap: 10px;
            min-width: 250px;
            z-index: 20;
            animation: popIn 0.3s ease-out;
        }

        h1 { 
            margin: 0; 
            color: #ff3333; 
            text-transform: uppercase; 
            letter-spacing: 3px; 
            font-size: 32px;
            text-shadow: 0 0 10px rgba(255, 51, 51, 0.5);
        }
        
        p { margin: 5px 0; font-size: 16px; color: #ccc; }
        
        .stats {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            font-size: 20px;
            font-weight: bold;
        }
        
        .stat-box {
            display: flex;
            flex-direction: column;
        }
        .stat-label { font-size: 12px; color: #888; text-transform: uppercase; }
        .stat-value { color: #fff; }

        .btn {
            background: linear-gradient(to bottom, #ff3333, #cc0000);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 20px;
            border-radius: 30px;
            margin-top: 10px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            box-shadow: 0 4px 0 #990000;
            transition: transform 0.1s;
        }
        .btn:active { 
            transform: translateY(4px); 
            box-shadow: 0 0 0 #990000;
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Exibição inicial */
        #startScreen { display: flex; }
    </style>
</head>
<body>

<div id="gameContainer">
    <canvas id="gameCanvas"></canvas>
    
    <div id="ui-layer">
        <!-- Score Gigante de Fundo -->
        <div class="score-board" id="bgScore">0</div>
        <!-- Score Topo -->
        <div class="current-score" id="scoreDisplay">0</div>

        <!-- Tela Inicial -->
        <div id="startScreen" class="message">
            <h1>Nível 8</h1>
            <p style="color: #ffaaaa;">⚠ Cuidado: Alta Velocidade</p>
            <p>Espaços minúsculos!</p>
            <button class="btn" onclick="startGame()">JOGAR</button>
        </div>

        <!-- Tela de Game Over -->
        <div id="gameOverScreen" class="message">
            <h1>Game Over</h1>
            <div class="stats">
                <div class="stat-box">
                    <span class="stat-label">Score</span>
                    <span class="stat-value" id="finalScore">0</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">Melhor</span>
                    <span class="stat-value" id="bestScore">0</span>
                </div>
            </div>
            <button class="btn" onclick="resetGame()">Tentar de Novo</button>
        </div>
    </div>
</div>

<script>
    // Configuração do Canvas
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // Referências da UI
    const startScreen = document.getElementById('startScreen');
    const gameOverScreen = document.getElementById('gameOverScreen');
    const scoreDisplay = document.getElementById('scoreDisplay');
    const bgScore = document.getElementById('bgScore');
    const finalScoreSpan = document.getElementById('finalScore');
    const bestScoreSpan = document.getElementById('bestScore');

    // Variáveis de Estado do Jogo
    let frames = 0;
    let score = 0;
    let highScore = localStorage.getItem('flappyLevel8_best') || 0;
    let isRunning = false;
    let isGameOver = false;

    // --- CONFIGURAÇÕES DO NÍVEL 8 (HARDCORE) ---
    const GAME_SPEED = 3.8;       // Muito rápido
    const GRAVITY = 0.40;         // Puxa pra baixo com força
    const JUMP_STRENGTH = 6.2;    // Pulo forte para compensar gravidade
    const PIPE_GAP = 95;          // Gap muito apertado (normal é ~150)
    const PIPE_INTERVAL_BASE = 80; // Frequência alta de canos

    // Ajuste de tamanho do canvas
    function resize() {
        // Pega o tamanho real do container
        const container = document.getElementById('gameContainer');
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // Objeto Pássaro
    const bird = {
        x: 50,
        y: 150,
        radius: 12, // Hitbox
        velocity: 0,
        rotation: 0,
        
        draw: function() {
            ctx.save();
            ctx.translate(this.x, this.y);
            
            // Rotação agressiva no nível 8
            let targetRotation = (this.velocity * 0.12);
            this.rotation = Math.max(-0.5, Math.min(0.5, targetRotation));
            ctx.rotate(this.rotation);
            
            // Corpo (Amarelo brilhante com contorno vermelho para destaque no fundo escuro)
            ctx.beginPath();
            ctx.arc(0, 0, this.radius, 0, Math.PI*2);
            ctx.fillStyle = '#FFD700';
            ctx.fill();
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#ff0000'; // Contorno "agressivo"
            ctx.stroke();
            
            // Olho (Bravo)
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(6, -6, 5, 0, Math.PI*2);
            ctx.fill();
            
            // Sobrancelha de raiva
            ctx.beginPath();
            ctx.moveTo(2, -10);
            ctx.lineTo(10, -4);
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Pupila
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(8, -6, 2, 0, Math.PI*2);
            ctx.fill();

            // Bico
            ctx.fillStyle = '#FF4500';
            ctx.beginPath();
            ctx.moveTo(8, 2);
            ctx.lineTo(16, 6);
            ctx.lineTo(8, 10);
            ctx.fill();

            ctx.restore();
        },
        
        update: function() {
            this.velocity += GRAVITY;
            this.y += this.velocity;

            // Colisão com o chão
            if (this.y + this.radius >= canvas.height - 20) {
                this.y = canvas.height - 20 - this.radius;
                gameOver();
            }
            
            // Colisão com o teto
            if (this.y - this.radius <= 0) {
                this.y = this.radius;
                this.velocity = 0;
            }
        },
        
        flap: function() {
            this.velocity = -JUMP_STRENGTH;
        }
    };

    // Objeto Canos (Obstáculos)
    const pipes = {
        items: [],
        w: 60, // Largura do cano
        
        draw: function() {
            for(let i = 0; i < this.items.length; i++) {
                let p = this.items[i];
                
                // Estilo "Industrial / Tóxico"
                let gradient = ctx.createLinearGradient(p.x, 0, p.x + this.w, 0);
                gradient.addColorStop(0, '#2e7d32'); // Verde escuro
                gradient.addColorStop(0.5, '#4caf50'); // Verde claro
                gradient.addColorStop(1, '#1b5e20'); // Verde escuro

                // Cano Superior
                ctx.fillStyle = gradient;
                ctx.fillRect(p.x, 0, this.w, p.y);
                
                // Borda Inferior do Cano Superior
                ctx.fillStyle = '#1b5e20';
                ctx.fillRect(p.x - 4, p.y - 20, this.w + 8, 20);
                
                // Cano Inferior
                let bottomY = p.y + PIPE_GAP;
                let bottomH = canvas.height - bottomY;
                
                ctx.fillStyle = gradient;
                ctx.fillRect(p.x, bottomY, this.w, bottomH);
                
                // Borda Superior do Cano Inferior
                ctx.fillStyle = '#1b5e20';
                ctx.fillRect(p.x - 4, bottomY, this.w + 8, 20);
            }
        },
        
        update: function() {
            // Lógica de spawn adaptativa
            // Se a tela for larga, espaçamos mais para manter o ritmo visual
            // Se estreita (mobile), usamos o intervalo base
            const spawnRate = PIPE_INTERVAL_BASE;

            if (frames % spawnRate === 0) {
                // Cálculo de posição aleatória difícil
                // Margem mínima de segurança nas pontas
                const minEdge = 50; 
                const maxY = canvas.height - minEdge - PIPE_GAP;
                const minY = minEdge;
                
                const randomY = Math.floor(Math.random() * (maxY - minY + 1) + minY);
                
                this.items.push({
                    x: canvas.width,
                    y: randomY,
                    passed: false
                });
            }
            
            for(let i = 0; i < this.items.length; i++) {
                let p = this.items[i];
                p.x -= GAME_SPEED;
                
                // Detecção de Colisão
                // Box do pássaro (reduzido para ser justo)
                let bLeft = bird.x - bird.radius + 4;
                let bRight = bird.x + bird.radius - 4;
                let bTop = bird.y - bird.radius + 4;
                let bBottom = bird.y + bird.radius - 4;

                // Box dos canos
                let pLeft = p.x;
                let pRight = p.x + this.w;
                let topPipeY = p.y;
                let botPipeY = p.y + PIPE_GAP;

                // Está dentro da área horizontal do cano?
                if (bRight > pLeft && bLeft < pRight) {
                    // Bateu em cima OU bateu embaixo?
                    if (bTop < topPipeY || bBottom > botPipeY) {
                        gameOver();
                    }
                }
                
                // Pontuação
                if (p.x + this.w < bird.x && !p.passed) {
                    score++;
                    updateScoreUI();
                    p.passed = true;
                }
                
                // Remove canos que saíram da tela
                if (p.x + this.w <= 0) {
                    this.items.shift();
                    i--;
                }
            }
        },
        
        reset: function() {
            this.items = [];
        }
    };

    function updateScoreUI() {
        scoreDisplay.innerText = score;
        bgScore.innerText = score;
    }

    // Loop Principal
    function loop() {
        if (!isRunning) return;

        bird.update();
        pipes.update();
        frames++;

        // Renderização
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Fundo decorativo (partículas rápidas para sensação de velocidade)
        ctx.fillStyle = 'rgba(255, 255, 255, 0.05)';
        for (let i = 0; i < 10; i++) {
            let x = (frames * 5 + i * 100) % canvas.width;
            let y = (i * 70) % canvas.height;
            ctx.fillRect(canvas.width - x, y, 40, 2); // Linhas de vento
        }

        pipes.draw();
        
        // Chão
        ctx.fillStyle = '#1a1a1a';
        ctx.fillRect(0, canvas.height - 20, canvas.width, 20);
        // Lava/Perigo no chão
        ctx.fillStyle = '#ff3333';
        ctx.fillRect(0, canvas.height - 20, canvas.width, 3);

        bird.draw();

        if (!isGameOver) {
            requestAnimationFrame(loop);
        }
    }

    // Controles do Jogo
    function startGame() {
        if (isRunning) {
            bird.flap();
        } else {
            // Resetar tudo
            bird.y = canvas.height / 2;
            bird.velocity = 0;
            pipes.reset();
            score = 0;
            frames = 0;
            isGameOver = false;
            isRunning = true;
            updateScoreUI();
            
            startScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            
            loop();
            bird.flap();
        }
    }

    function gameOver() {
        if (isGameOver) return;
        isGameOver = true;
        isRunning = false;
        
        if (score > highScore) {
            highScore = score;
            localStorage.setItem('flappyLevel8_best', highScore);
        }
        
        finalScoreSpan.innerText = score;
        bestScoreSpan.innerText = highScore;
        
        // Pequeno delay para não reiniciar acidentalmente
        setTimeout(() => {
            gameOverScreen.style.display = 'flex';
        }, 300);
    }

    function resetGame() {
        gameOverScreen.style.display = 'none';
        startScreen.style.display = 'flex';
        
        // Limpa visual
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        bird.y = canvas.height / 2;
        bird.rotation = 0;
        bird.draw();
        score = 0;
        updateScoreUI();
    }

    // Listeners de Input (Mouse, Touch, Teclado)
    function handleInput(e) {
        if (e.type === 'keydown' && e.code !== 'Space' && e.code !== 'ArrowUp') return;
        if (e.type === 'touchstart') e.preventDefault(); // Evita scroll
        
        // Se o clique for em um botão, ignora (o botão tem seu próprio onClick)
        if (e.target.tagName === 'BUTTON') return;

        if (isGameOver) {
            // Clique na tela de game over não faz nada imediatamente (usa o botão)
            return;
        }

        if (!isRunning && startScreen.style.display !== 'none') {
            startGame();
        } else if (isRunning) {
            bird.flap();
        }
    }

    window.addEventListener('keydown', handleInput);
    window.addEventListener('touchstart', handleInput, {passive: false});
    window.addEventListener('mousedown', handleInput);

    // Inicialização
    resize();
    bird.draw();

</script>
</body>
</html>

